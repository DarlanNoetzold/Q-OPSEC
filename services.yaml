services:
  interceptor_api:
    type: spring
    cwd: "./interceptor_api"
    # escolha um dos starts abaixo e remova os outros:
    # start: ["mvn", "spring-boot:run", "-DskipTests"]
    # start: ["./mvnw", "spring-boot:run", "-DskipTests"]	
    # start: ["java", "-jar", "target/interceptor_api.jar"]
    start: ["mvn", "spring-boot:run", "-DskipTests"]
    health: "http://127.0.0.1:8080/actuator/health"
    log_file: "./logs/interceptor_api.log"
    env: {}

  context_api:
    type: spring
    cwd: "./context_api"
    start: ["mvn", "spring-boot:run", "-DskipTests"]
    health: "http://127.0.0.1:8081/actuator/health"
    log_file: "./logs/context_api.log"
    env: {}

  validation_send_api:
    type: spring
    cwd: "./validation_send_api"
    start: ["mvn", "spring-boot:run", "-DskipTests"]
    health: "http://127.0.0.1:8005/actuator/health"
    log_file: "./logs/validation_send_api.log"
    env: {}

  dataset_extractor:
    type: script
    cwd: "./dataset_procedure"
    start: ["python", "main.py"]
    health: ""  # script único (sem servidor); pode deixar vazio
    log_file: "./logs/dataset_extractor.log"
    env: {}

  classify_scheduler:
    type: script
    cwd: "./classify_scheduler"
    start: ["python", "-m", "main", "--mode", "train-once", "--data", "context_dataset_advanced.csv", "--registry", "./model_registry"]
    health: ""  # script único
    log_file: "./logs/classify_scheduler.log"
    env: {}

  key_destination_engine:
    type: fastapi
    cwd: "./key_destination_engine"
    start: ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8003", "--reload"]
    health: "http://127.0.0.1:8003/health"
    log_file: "./logs/key_destination_engine.log"
    env: {}

  confiability_service:
    type: fastapi
    cwd: "./confiability_service"
    start: ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8083", "--reload"]
    health: "http://127.0.0.1:8083/health"
    log_file: "./logs/confiability_service.log"
    env: {}

  crypto_module:
    type: fastapi
    cwd: "./crypto_module"
    start: ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8004", "--reload"]
    health: "http://127.0.0.1:8004/health"
    log_file: "./logs/crypto_module.log"
    env: {}

  risk_service:
    type: fastapi
    cwd: "./risk_service"
    start: ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8082", "--reload"]
    health: "http://127.0.0.1:8082/health"
    log_file: "./logs/risk_service.log"
    env: {}

  handshake_negotiator:
    type: fastapi
    cwd: "./handshake_negotiator"
    start: ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8001", "--reload", "--ws", "none"]
    health: "http://127.0.0.1:8001/docs"
    log_file: "./logs/handshake_negotiator.log"
    env: {}

  kms_service:
    type: fastapi
    cwd: "./kms_service"
    start: ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8002", "--reload"]
    health: "http://127.0.0.1:8002/health"
    log_file: "./logs/kms_service.log"
    env: {}

  classification_agent:
    type: fastapi
    cwd: "./classify_agent"
    start: ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8088", "--reload"]
    health: "http://127.0.0.1:8088/api/v1/health"
    metrics: "http://127.0.0.1:9090/metrics"  # porta de métricas separada
    log_file: "./logs/classification_agent.log"
    env:
      CLASSIFY_API_KEY: "your-api-key-for-authentication"

  rl_engine:
    type: fastapi
    cwd: "./rl_engine"
    start: ["uvicorn", "rl_engine.main:app", "--host", "0.0.0.0", "--port", "9009", "--reload"]
    health: "http://127.0.0.1:9009/docs"
    log_file: "./logs/rl_engine.log"
    env: {}

paths:
  datasets_dir: "./datasets"
  model_registry: "./classify_scheduler/model_registry"
  risk_registry: "./risk_service/model_registry"
  conf_registry: "./confiability_service/model_registry"
  logs_dir: "./logs"

# Ordem recomendada para subir tudo
startup_order:
  - kms_service
  - key_destination_engine
  - crypto_module
  - validation_send_api
  - handshake_negotiator
  - risk_service
  - confiability_service
  - context_api
  - classification_agent
  - rl_engine
  - interceptor_api